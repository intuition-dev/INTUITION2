
head
    script(src='//cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.slim.min.js')
    script(src='//js.stripe.com/v3')
    script(src='https://js.stripe.com/v3/')

body

    style.
        .d-hide {
            display: none;
        }
        .d-flex {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        .wrap {
            margin: 2rem;
        }
        form {
            margin: 1rem;
            width: 50%;
        }
        label {
            display: inline-block;
            padding-right: 10px;
        }
        label[for='card-element'] {
            margin-bottom: 1rem;
        }
        .payment-form button {
            border-radius: 0;
            margin-top: 1rem;
            border: 0;
            color: #fff;
            transition: background .3s linear;
            cursor: pointer;
            background: #555;
            padding: 9px 10px 7px 10px;
            border-bottom: 4px solid #444;

        }
        .payment-form button:active {
            padding: 10px;
            border: 0;
        }
        .payment-form button:hover, .payment-form button:active, .payment-form button:focus {
            box-shadow: none;
            outline: none;
        }



    .wrap(data-js="card")
        .d-flex
            label CreditCard
            input(type="radio" name="p-method" value="card")
        form.d-hide#payment-form.payment-form(action='/post/charge', method='post', autocomplete="off")
            script.
                var stripe = Stripe('pk_test_p1V4wvgaB2ldHqyWH5mYLwLI');
                var elements = stripe.elements();

            div.form-row
                label(for="card-element") Credit or debit card
                //- A Stripe Element will be inserted here.
                div#card-element
                //- Used to display Element errors.
                div#card-errors(role="alert")
            button Submit Payment

            script.
                // Custom styling can be passed to options when creating an Element.
                var style = {
                    base: {
                        // Add your base input styles here. For example:
                        fontSize: '16px',
                        color: "#32325d",
                        margin: '1rem 0',
                        borderBottom: '1px solid #000'
                    }
                };

                // Create an instance of the card Element.
                var card = elements.create('card', {style: style});

                // Add an instance of the card Element into the `card-element` <div>.
                card.mount('#card-element');
                
                // change event listener, display errors
                card.addEventListener('change', function(event) {
                    var displayError = document.getElementById('card-errors');
                    if (event.error) {
                        displayError.textContent = event.error.message;
                    } else {
                        displayError.textContent = '';
                    }
                });

                // Create a token or display an error when the form is submitted.
                var form = document.getElementById('payment-form');
                form.addEventListener('submit', function(event) {
                    event.preventDefault();

                    stripe.createToken(card).then(function(result) {
                        if (result.error) {
                            // Inform the customer that there was an error.
                            var errorElement = document.getElementById('card-errors');
                            errorElement.textContent = result.error.message;
                        } else {
                            // Send the token to your server.
                            stripeTokenHandler(result.token);
                        }
                    });
                });

                // submit token to server
                function stripeTokenHandler(token) {
                    // Insert the token ID into the form so it gets submitted to the server
                    var form = document.getElementById('payment-form');
                    var hiddenInput = document.createElement('input');
                    hiddenInput.setAttribute('type', 'hidden');
                    hiddenInput.setAttribute('name', 'stripeToken');
                    hiddenInput.setAttribute('value', token.id);
                    form.appendChild(hiddenInput);

                    // Submit the form
                    form.submit();
                }

   
    .wrap(data-js="ach")
        .d-flex
            label ACH
            input(type="radio" name="p-method" value="ach" checked="checked")

        form(action='/post/charge', method='post', autocomplete="off")
            article
                label Amount: $5.00
            script(
                src='//checkout.stripe.com/checkout.js',
                class='stripe-button',
                data-key='pk_test_p1V4wvgaB2ldHqyWH5mYLwLI'
                data-locale='auto',
                data-description='Sample Charge',
                data-amount='500')



    .wrap(data-js="ali")
        .d-flex
            label AliPay
            input(type="radio" name="p-method" value="alipay")
        form.d-hide(action='/post/charge', method='post', autocomplete="off")
            article
                label Amount: $5.00
            script(
                src='//checkout.stripe.com/checkout.js',
                class='stripe-button',
                data-key='pk_test_p1V4wvgaB2ldHqyWH5mYLwLI'
                data-locale='auto',
                data-description='Sample Charge',
                data-amount='500')

    .wrap(data-js="wechat")
        .d-flex
            label WeChat Pay
            input(type="radio" name="p-method" value="wechat")
        form.d-hide(action='/post/charge', method='post', autocomplete="off" )
            article
                label Amount: $5.00
            script(
                src='//checkout.stripe.com/checkout.js',
                class='stripe-button',
                data-key='pk_test_p1V4wvgaB2ldHqyWH5mYLwLI'
                data-locale='auto',
                data-description='Sample Charge',
                data-amount='500')

    script.
         (function($){
            $('input[type="radio"]').click(function() {
                var method = $(this).parents('.wrap').attr('data-js');
                $('form').addClass('d-hide');
                $(this).parents('.wrap').find('form').removeClass('d-hide');
                console.log('method', method);
            });
         })(jQuery); 

         var stripe = Stripe('pk_test_MVkQi47ZUw5dtiLVpoExDU1r');
         var elements = stripe.elements()

